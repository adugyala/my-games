<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Milk Jug Puzzle!</title>
    <style>
        :root {
            --bg-color: #E0F7FA;
            --text-color: #006064;
            --jar-border: #4E342E; /* Slightly darker border for contrast */
            --milk-color: #ffffff;
            --milk-shadow: #81D4FA; /* Stronger blue shadow for milk depth */
            --highlight: #FFEB3B;
            --target-line: #FF5722;
            /* NEW: Color for empty glass space */
            --empty-glass-bg: rgba(176, 190, 197, 0.5); 
        }

        body {
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { margin-bottom: 10px; }
        
        .instructions {
            background-color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-width: 600px;
            text-align: center;
            margin-bottom: 20px;
            border: 3px solid var(--text-color);
        }

        .goal-highlight {
            color: var(--target-line);
            font-weight: bold;
            font-size: 1.2em;
        }

        #game-message {
            font-size: 1.2em;
            font-weight: bold;
            min-height: 30px;
            color: #0056b3;
            margin-bottom: 10px;
            text-align: center;
        }

        .jars-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px; /* Slightly closer together for phones */
            margin-top: 20px;
            padding-bottom: 20px;
            width: 100%;
            max-width: 800px;
        }

        .jar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.1s;
            flex: 1; /* allow them to shrink on small screens */
            max-width: 120px;
        }

        .jar-wrapper:hover {
            transform: scale(1.02);
        }

        /* When a jar is selected to pour FROM */
        .jar-wrapper.selected .jar {
            box-shadow: 0 0 20px var(--highlight), inset 0 0 20px rgba(0,0,0,0.3);
            border-color: #FFC107;
        }

        .jar {
            position: relative;
            width: 100%; /* Fill wrapper width */
            /* Heights are relative to capacity. Max 11gal = 300px height */
            
            /* UPDATED BACKGROUND FOR BETTER VISIBILITY */
            background-color: var(--empty-glass-bg);
            
            border: 6px solid var(--jar-border);
            border-radius: 10px 10px 40px 40px; /* Rounded bottom */
            overflow: hidden; /* Hide milk outside the jar */
            
            /* Stronger inner shadow for depth */
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
            
            display: flex;
            align-items: flex-end; /* Milk sits at bottom */
        }

        .liquid {
            width: 100%;
            background-color: var(--milk-color);
            /* Deeper shadow at bottom of milk */
            box-shadow: inset 0 -10px 15px var(--milk-shadow);
            transition: height 0.5s ease-in-out; /* Smooth pouring animation */
            position: relative;
        }
        
        /* bubbly top of milk */
        .liquid::after {
            content: '';
            position: absolute;
            top: -6px;
            left: 0;
            width: 100%;
            height: 12px;
            background-color: var(--milk-color);
            border-radius: 50%;
        }

        /* Visual marker for the 5 gallon target */
        #target-line-marker {
            position: absolute;
            /* 5 gallons out of 11 is roughly 45.45% from the bottom */
            bottom: calc(45.45%); 
            width: 100%;
            height: 4px;
            background-color: var(--target-line);
            z-index: 10;
            opacity: 0.8;
            pointer-events: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        /* Label for the target line, hidden on very small screens */
        #target-line-marker::after {
             content: 'Target (5g)';
             position: absolute;
             right: -75px;
             top: -12px;
             color: var(--target-line);
             font-weight: bold;
             font-size: 0.9em;
             text-shadow: 1px 1px white;
        }
        @media (max-width: 450px) {
            #target-line-marker::after { display: none; } /* Hide label on thin phones */
        }

        /* 5 gallon line on 7 gallon jar */
        #target-line-marker-7gal {
            position: absolute;
            /* 5 gallons out of 7 is roughly 71.43% from the bottom */
            bottom: calc(71.43%); 
            width: 100%;
            height: 4px;
            background-color: var(--target-line);
            z-index: 10;
            opacity: 0.8;
            pointer-events: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .jar-label {
            margin-top: 10px;
            font-weight: bold;
            background: white;
            padding: 5px 10px;
            border-radius: 10px;
            border: 2px solid var(--jar-border);
            white-space: nowrap;
            font-size: 0.9em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 10px 30px;
            font-size: 1.2em;
            font-family: inherit;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.1s;
        }

        #reset-btn {
            background-color: #FF5722;
            box-shadow: 0 4px #E64A19;
        }
        #reset-btn:active {
            box-shadow: 0 2px #E64A19;
            transform: translateY(2px);
        }

        #undo-btn {
            background-color: #2196F3;
            box-shadow: 0 4px #1565C0;
        }
        #undo-btn:active {
            box-shadow: 0 2px #1565C0;
            transform: translateY(2px);
        }
        #undo-btn:disabled {
            background-color: #CCCCCC;
            box-shadow: 0 4px #999999;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .stats {
            display: flex;
            gap: 30px;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background-color: white;
            padding: 10px 20px;
            border-radius: 15px;
            border: 3px solid var(--text-color);
            min-width: 120px;
            text-align: center;
        }

        /* Specific heights for visual scaling based on capacity */
        #jar-0-container .jar { height: 300px; } /* 11 gal */
        #jar-1-container .jar { height: 190px; } /* 7 gal roughly proportional */
        #jar-2-container .jar { height: 110px; } /* 4 gal roughly proportional */

    </style>
</head>
<body>

    <h2>ðŸ¥› The Milk Jug Puzzle ðŸ¥›</h2>

    <div class="instructions">
        <p>Goal: Get exactly <span class="goal-highlight">5 Gallons</span> of milk into any jar!</p>
        <p>How to play: Tap a jar to take milk <b>FROM</b>, then tap another jar to pour <b>INTO</b>.</p>
    </div>

    <div id="game-message">Tap a jar to start pouring!</div>

    <div class="stats">
        <div class="stat-item">
            Steps: <span id="step-count">0</span>
        </div>
        <div class="stat-item">
            Time: <span id="timer">0:00</span>
        </div>
    </div>

    <div class="jars-container">
        <div class="jar-wrapper" id="jar-0-container" onclick="handleJarClick(0)">
            <div class="jar">
                <div id="target-line-marker"></div>
                <div class="liquid" id="liquid-0" style="height: 100%;"></div>
            </div>
            <div class="jar-label" id="label-0">11 / 11 Gal</div>
        </div>

        <div class="jar-wrapper" id="jar-1-container" onclick="handleJarClick(1)">
            <div class="jar">
                <div id="target-line-marker-7gal"></div>
                <div class="liquid" id="liquid-1" style="height: 0%;"></div>
            </div>
            <div class="jar-label" id="label-1">0 / 7 Gal</div>
        </div>

        <div class="jar-wrapper" id="jar-2-container" onclick="handleJarClick(2)">
            <div class="jar">
                <div class="liquid" id="liquid-2" style="height: 0%;"></div>
            </div>
            <div class="jar-label" id="label-2">0 / 4 Gal</div>
        </div>
    </div>

    <div class="controls">
        <button id="undo-btn" onclick="undoLastMove()" disabled>Undo â†¶</button>
        <button id="reset-btn" onclick="resetGame()">Reset Game ðŸ”„</button>
    </div>

    <script>
        // --- Game Configuration & State ---
        const capacities = [11, 7, 4];
        const targetGoal = 5;
        
        // Current gallons in each jar [Jar1, Jar2, Jar3]
        let gameState = [11, 0, 0]; 
        
        // Track player interaction state
        let selectedSourceIndex = null;
        let gameWon = false;

        // Game statistics
        let stepCount = 0;
        let moveHistory = [];
        let timerInterval = null;
        let elapsedSeconds = 0;
        let gameStarted = false;

        // --- DOM Elements references ---
        const messageDisplay = document.getElementById('game-message');
        const jarContainers = [
            document.getElementById('jar-0-container'),
            document.getElementById('jar-1-container'),
            document.getElementById('jar-2-container')
        ];
        const liquids = [
            document.getElementById('liquid-0'),
            document.getElementById('liquid-1'),
            document.getElementById('liquid-2')
        ];
        const labels = [
            document.getElementById('label-0'),
            document.getElementById('label-1'),
            document.getElementById('label-2')
        ];
        const stepCountDisplay = document.getElementById('step-count');
        const timerDisplay = document.getElementById('timer');
        const undoBtn = document.getElementById('undo-btn');

        // --- Timer Functions ---
        function startTimer() {
            if (!gameStarted) {
                gameStarted = true;
                timerInterval = setInterval(() => {
                    elapsedSeconds++;
                    updateTimerDisplay();
                }, 1000);
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(elapsedSeconds / 60);
            const seconds = elapsedSeconds % 60;
            timerDisplay.innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // --- Core Game Logic ---

        // The math behind pouring liquid
        function calculatePour(srcIdx, dstIdx) {
            const amountInSource = gameState[srcIdx];
            const emptySpaceInDest = capacities[dstIdx] - gameState[dstIdx];

            // We pour whichever is smaller: the amount we have, or the space available
            const amountToPour = Math.min(amountInSource, emptySpaceInDest);
            
            return amountToPour;
        }

        // Handles user clicks on jars
        function handleJarClick(index) {
            if (gameWon) return; // Stop input if won

            if (selectedSourceIndex === null) {
                // --- Phase 1: Selecting Source ---
                if (gameState[index] === 0) {
                    showMessage("That jar is empty! Pick another one.", true);
                    return;
                }
                selectedSourceIndex = index;
                jarContainers[index].classList.add('selected');
                showMessage(`Pouring from the ${capacities[index]} Gal jar... Where to?`);

            } else {
                // --- Phase 2: Selecting Destination ---
                if (index === selectedSourceIndex) {
                    // Deselect if clicking the same jar
                    resetSelection();
                    showMessage("Selection cancelled. Pick a jar to pour from.");
                    return;
                }

                if (gameState[index] === capacities[index]) {
                     showMessage("That destination is already full!", true);
                     return;
                }

                // Start timer on first move
                if (!gameStarted) {
                    startTimer();
                }

                // Perform the pour
                const amount = calculatePour(selectedSourceIndex, index);
                const previousState = [...gameState];
                gameState[selectedSourceIndex] -= amount;
                gameState[index] += amount;
                
                // Record move in history for undo
                moveHistory.push(previousState);
                stepCount++;
                stepCountDisplay.innerText = stepCount;
                undoBtn.disabled = false;
                
                resetSelection();
                updateView();
                checkWinCondition();
                
                if (!gameWon) {
                     showMessage(`Poured ${amount} gallons. What's next?`);
                }
            }
        }

        // --- Undo Function ---
        function undoLastMove() {
            if (moveHistory.length === 0) return;

            gameState = moveHistory.pop();
            stepCount--;
            stepCountDisplay.innerText = stepCount;
            
            if (moveHistory.length === 0) {
                undoBtn.disabled = true;
            }

            updateView();
            showMessage("Move undone. What's next?");
        }

        // --- Helper Functions ---

        function resetSelection() {
            if (selectedSourceIndex !== null) {
                jarContainers[selectedSourceIndex].classList.remove('selected');
            }
            selectedSourceIndex = null;
        }

        function checkWinCondition() {
            // Check if any jar currently holds exactly the target amount
            if (gameState.includes(targetGoal)) {
                gameWon = true;
                stopTimer();
                showMessage(`ðŸŽ‰ YOU DID IT! You measured exactly 5 Gallons in ${stepCount} steps! ðŸŽ‰`);
                document.body.style.backgroundColor = "#d4edda"; // Success green bg
                confettiEffect(); // Optional visual flair
            }
        }

        function showMessage(msg, isError = false) {
            messageDisplay.innerText = msg;
            messageDisplay.style.color = isError ? "#D32F2F" : "#0056b3";
        }

        // Updates the HTML elements to match the JavaScript gameState data
        function updateView() {
            for (let i = 0; i < 3; i++) {
                // 1. Update Label Text
                labels[i].innerText = `${gameState[i]} / ${capacities[i]} Gal`;
                
                // 2. Update Liquid Height Percentage
                const percentage = (gameState[i] / capacities[i]) * 100;
                liquids[i].style.height = `${percentage}%`;
            }
        }

        function resetGame() {
            gameState = [11, 0, 0];
            selectedSourceIndex = null;
            gameWon = false;
            stepCount = 0;
            moveHistory = [];
            elapsedSeconds = 0;
            gameStarted = false;
            stopTimer();
            
            document.body.style.backgroundColor = "#E0F7FA"; // Reset bg color
            jarContainers.forEach(jc => jc.classList.remove('selected'));
            showMessage("Tap a jar to start pouring!");
            stepCountDisplay.innerText = "0";
            timerDisplay.innerText = "0:00";
            undoBtn.disabled = true;
            updateView();
        }

        // Simple confetti effect for winning (totally optional visual polish)
        function confettiEffect() {
            for(let i=0; i<50; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.backgroundColor = ['#FFD700', '#FF6347', '#87CEEB', '#32CD32'][Math.floor(Math.random()*4)];
                confetti.style.borderRadius = '50%';
                confetti.style.zIndex = '1000';
                document.body.appendChild(confetti);

                const speed = 1 + Math.random() * 3;
                const angle = Math.random() * 360;
                let posY = -10;
                let posX = parseFloat(confetti.style.left);

                const interval = setInterval(() => {
                    posY += speed;
                    posX += Math.sin(angle) * 2;
                    confetti.style.top = posY + 'px';
                    confetti.style.left = posX + 'px';
                    if(posY > window.innerHeight) {
                        clearInterval(interval);
                        document.body.removeChild(confetti);
                    }
                }, 20);
            }
        }

        // Initialize view on load
        updateView();
    </script>
</body>
</html>